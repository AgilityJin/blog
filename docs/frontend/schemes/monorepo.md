---
title: Monorepo 工程搭建
date: 2020-12-12
categories:
  - 前端
  - schemes
tags:
  - monorepo
---

[[TOC]]

## 初始化工程

```shell
mkdir [workspace-name]
cd [workspace-name]
# 初始化工程
yarn init
# 安装基础依赖
yarn @commitlint/cli @commitlint/config-conventional @lerna/project commitizen husky cz-lerna-changelog -D
```

## 初始化基础文件

根目录创建 commitlint.config.js

```JavaScript
module.exports = { extends: ['@commitlint/config-conventional'] }
```

根目录创建 lerna.json

```json
{
  // 各package维护自身的版本,移除则版本统一
  "version": "independent",
  "npmClient": "yarn",
  "useWorkspaces": true,
  "command": {
    "publish": {
      "ignoreChanges": ["*.md"]
    },
    "bootstrap": {
      "hoist": true
    },
    "version": {
      "conventionalCommits": true,
      // 存在commit校验时指定提交内容
      "message": "chore(release): publish %s"
    }
  },
  // package所处位置
  "packages": ["packages/*"]
}
```

创建忽略追踪的基础配置文件

```shell
# Created by .ignore support plugin (hsz.mobi)

## Examples
### *.a // 所有以 '.a' 为后缀的文件都屏蔽掉
### tags // 所有名为tags屏蔽
### core.* // 所有core开头的文件屏蔽
### dist/ // 屏蔽dist目录
### dist/* // 屏蔽dist内所有文件,不屏蔽目录本身
### /lib  // 只屏蔽目录根目录下的lib文件,其他不屏蔽
### !/readme.md # 不屏蔽readme.md文件

### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
testem.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env
.env.local
.env.*.local

# parcel-bundler cache (https://parceljs.org/)
.cache

# next.js build output
.next

# nuxt.js build output
.nuxt

# Nuxt generate
# dist

# vuepress build output
.vuepress/dist

# Serverless directories
.serverless

# IDE / Editor
.idea
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history/*

*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Service worker
sw.*

# System Files
.DS_Store
Thumbs.db

# Vim swap files
*.swp

# 代码质量报告
code-report

# misc
package-lock.json
yarn.lock

# compiled output
tmp
out-tsc
lib
dist

# Only exists if Bazel was run
bazel-out

# profiling files
chrome-profiler-events*.json
speed-measure-plugin*.json
```

配置package.json文件

```json
{
  "name": "blog", // 工程名
  "version": "1.0.0",
  "description": "个人博客", // 添加项目描述
  "main": "index.js",
  "author": "Agility Jin <Agility_Jin@outlook.com>",
  "license": "MIT",
  "repository": "git@github.com:AgilityJin/blog.git", // 工程仓库地址
  "private": true,
  "scripts": {
    "commit": "git cz"
  },
  "workspaces": {
    "packages": [
      "packages/*"
    ]
  },
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-lerna-changelog"
    }
  },
  "husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "devDependencies": {
    // 建议安装最新版本依赖
    "@commitlint/cli": "^11.0.0",
    "@commitlint/config-conventional": "^11.0.0",
    "@lerna/project": "^3.21.0",
    "commitizen": "^4.2.2",
    "cz-lerna-changelog": "^2.0.3",
    "husky": "^4.3.5"
  }
}
```

此时的文件目录如下,后续所有子工程均可在packages内创建,发布阶段采用 lerna 管理,依赖关系由yarn管理

```shell
.
├── .gitignore
├── commitlint.config.js
├── lerna.json
├── package.json
├── packages # 各package所在的工作区
└── yarn.lock
```
